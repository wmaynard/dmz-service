.auto-deploy:
  image: "registry.gitlab.com/gitlab-org/cluster-integration/auto-deploy-image:v2.12.0"
  dependencies: []
  allow_failure: false
  script:
    - auto-deploy check_kube_domain
    - auto-deploy download_chart
    - auto-deploy ensure_namespace
    - auto-deploy initialize_tiller
    - auto-deploy create_secret
    - auto-deploy deploy
  rules:
    - if: '$CI_KUBERNETES_ACTIVE == null || $CI_KUBERNETES_ACTIVE == ""'
      when: never
    - if: '$CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH'
      when: never
    - if: $CI_COMMIT_TAG
      when: never
    - when: manual

dev:
  extends: .auto-deploy
  stage: dev
  environment:
    name: dev
    url: https://portal-eng.tower.cdrentertainment.com/

stage-a:
  extends: .auto-deploy
  stage: staging
  environment:
    name: stage-a
    url: https://portal.tower.cdrentertainment.com/

# production:
#   extends: .auto-deploy
#   stage: production
#   tags:
#     - production
#   environment:
#     name: production/platform
#     url: https://portal.tower.rumblegames.com/


@{
    ViewData["Title"] = "Global Messages";
}

@functions{

}

<script>
    function OpenEdit(id) {
        $(".edit-container").addClass("invisible");
        @ViewData["EditId"] = id;
    }
    
    function CloseEdit() {
        $(".edit-container").removeClass("invisible");
        @ViewData["EditId"] = null;
    }
    
    function OpenDelete(id) {
        $(".delete-container").addClass("invisible");
        @ViewData["DeleteId"] = id;
    }
    
    function CloseDelete() {
        $(".delete-container").removeClass("invisible");
        @ViewData["DeleteId"] = null;
    }
</script>

<div class="mailbox-page-container">
    <div class="toggle-container">
        @Html.ActionLink(linkText: "Group", actionName: "Group", controllerName: "Mailbox", routeValues: new {}, htmlAttributes: new {})
    </div>
    <br/>

    <h2>@ViewData["Title"]</h2>

    <p>@ViewData["Success"]</p>

    <div class="global-container">
    <div class = "invisible overlay">
        <div class = "invisible edit-container">
            <h1>Edit Message</h1>
            <p>Leave field empty if no change.</p>
            <p>Note: incorrectly formatted entries are ignored.</p>
            <form class = "message-info">
                <label for="editSubject" class="subject">Subject</label>
                <input id="editSubject" class="subject" type="text" placeholder="Subject" maxlength="29">
                <br />
                <label for="editBody" class="body">Body</label>
                <textarea id="editBody" class="body" type="text" placeholder="Body" rows="3"></textarea>
                <br />
                <label for="editAttachments" class="attachments">Attachments (separated by "," or "|")</label>
                <input id="editAttachments" class="attachments" type="text" placeholder="ex: currency soft_currency 1500 | hero warlord">
                <br />
                <label for="editVisibleFrom" class="visibleFrom">Visible From (UTC)</label>
                <input id="editVisibleFrom" class="visibleFrom" type="datetime-local" placeholder="2022-01-01T00:00">
                <br />
                <label for="editExpiration" class="expiration">Expiration (UTC)</label>
                <input id="editExpiration" class="expiration" type="datetime-local" placeholder="2022-01-01T00:00">
                <br />
                <label for="editIcon" class="icon">Icon</label>
                <select id="editIcon" class="icon" placeholder="Icon">
                    <option value="">default (empty)</option>
                    <option value="atlas-icons[pvp]">atlas-icons[pvp]</option>
                </select>
                <br />
                <label for="editBanner" class="banner">Banner</label>
                <select id="editBanner" class="banner" placeholder="Banner">
                    <option value="">default (empty)</option>
                    <option value="atlas-events[gold_blitz]">atlas-events[gold_blitz]</option>
                    <option value="atlas-dialog_banners[star_rewards_dialog_banner]">atlas-dialog_banners[star_rewards_dialog_banner]</option>
                </select>
                <br />
                <label for="editStatus" class="status">Reset Status</label>
                <input id="editStatus" class="status" type="checkbox">
                <br />
                <label for="editForAccountsBefore" class="forAccountsBefore">For Accounts Before</label>
                <input id="editForAccountsBefore" class="forAccountsBefore" type="datetime-local" placeholder="2022-01-01T00:00">
                <br />
                <label for="editInternalNote" class="internalNote">Internal Note</label>
                <input id="editInternalNote" class="internalNote" type="text" placeholder="Internal Note">
                <button class="edit-confirm" type="submit">Confirm</button>
                <button class="edit-cancel">Cancel</button>
            </form>
        </div>
        <div class = "invisible delete-container">
            <h1>Delete Message</h1>
            <p>Are you sure you would like to delete this message?</p>
            <button class="delete-confirm" type="submit">Confirm</button>
            <button class="delete-cancel">Cancel</button>
        </div>
    </div>
        <div class="send-global-container">
            <form class="message-info" method="post" asp-controller="Mailbox" asp-action="Global">
                <label for="newSubject" class="subject">Subject*</label>
                <input id="newSubject" class="subject" type="text" name="subject" placeholder="Subject" maxlength="29" required>
                <br/>
                <label for="newBody" class="body">Body*</label>
                <textarea id="newBody" class="body" type="text" name="body" placeholder="Body" rows="3" required></textarea>
                <br/>
                <label for="newAttachments" class="attachments">Attachments (separated by "," or "|")</label>
                <input id="newAttachments" class="attachments" type="text" name="attachments" placeholder="ex: currency soft_currency 1500 | hero warlord">
                <br/>
                <label for="newVisibleFrom" class="visibleFrom">Visible From (UTC)*</label>
                <input id="newVisibleFrom" class="visibleFrom" name="visibleFrom" type="datetime-local" required>
                <br/>
                <label for="newExpiration" class="expiration">Expiration (UTC)*</label>
                <input id="newExpiration" class="expiration" name="expiration" type="datetime-local" required>
                <br/>
                <label for="newIcon" class="icon">Icon</label>
                <select id="newIcon" class="icon" name="icon" placeholder="Icon">
                    <option value="">default (empty)</option>
                    <option value="atlas-icons[pvp]">atlas-icons[pvp]</option>
                </select>
                <br/>
                <label for="newBanner" class="banner">Banner</label>
                <select id="newBanner" class="banner" name="banner" placeholder="Banner">
                    <option value="">default (empty)</option>
                    <option value="atlas-events[gold_blitz]">atlas-events[gold_blitz]</option>
                    <option value="atlas-dialog_banners[star_rewards_dialog_banner]">atlas-dialog_banners[star_rewards_dialog_banner]</option>
                </select>
                <br/>
                <label for="newForAccountsBefore" class="forAccountsBefore">For Accounts Before (UTC)</label>
                <input id="newForAccountsBefore" class="forAccountsBefore" name="forAccountsBefore" type="datetime-local">
                <br/>
                <label for="newInternalNote" class="internalNote">Internal Note</label>
                <input id="newInternalNote" class="internalNote" type="text" name="internalNote" placeholder="Internal Note">
                <br/>
                <button id="sendGlobalMessageButton" type="submit">Send</button>
            </form>
        </div>
        <div class="active-globals-container">
            <p>@ViewData["Exist"]</p>

            <h3>Active Global Messages</h3>
            <table id="activeGlobals" class="globalMessages">
                <tr>
                    <td class="id">Id</td>
                    <td class="subject">Subject</td>
                    <td class="body">Body</td>
                    <td class="attachments">Attachments</td>
                    <td class="visibleFrom">Visible From (UTC)</td>
                    <td class="expiration">Expiration (UTC)</td>
                    <td class="icon">Icon</td>
                    <td class="banner">Banner</td>
                    <td class="internalNote">Internal Note</td>
                    <td class="forAccountsBefore">For Accounts Before (UTC)</td>
                    <td class="edit">Edit</td>
                    <td class="delete">Delete</td>
                </tr>
                @foreach (GlobalMessage data in (List<GlobalMessage>) ViewData["ActiveGlobalMessages"])
                {
                    <tr>
                        <td>@data.Id</td>
                        <td>@data.Subject</td>
                        <td>@data.Body</td>
                        <td>
                            @foreach (Attachment attachment in data.Attachments)
                            {
                                <p>{"type": @attachment.Type, "rewardId": @attachment.RewardId, "quantity": @attachment.Quantity}</p>
                            }
                        </td>
                        <td>@data.VisibleFrom</td>
                        <td>@data.Expiration</td>
                        <td>@data.Icon</td>
                        <td>@data.Banner</td>
                        <td>@data.InternalNote</td>
                        <td>@data.ForAccountsBefore</td>
                        <td><button onclick="OpenEdit(@data.Id)">Edit</button></td>
                        <td><button onclick="OpenDelete(@data.Id)">Delete</button></td>
                    </tr>
                }
            </table>
        </div>
    
        <div class="expired-globals-container">
            <h3>Expired Global Messages</h3>
            <table id="expiredGlobals" class="globalMessages">
                <tr>
                    <td class="id">Id</td>
                    <td class="subject">Subject</td>
                    <td class="body">Body</td>
                    <td class="attachments">Attachments</td>
                    <td class="visibleFrom">Visible From (UTC)</td>
                    <td class="expiration">Expiration (UTC)</td>
                    <td class="icon">Icon</td>
                    <td class="banner">Banner</td>
                    <td class="internalNote">Internal Note</td>
                    <td class="forAccountsBefore">For Accounts Before (UTC)</td>
                    <td class="edit">Edit</td>
                    <td class="delete">Expired</td>
                </tr>

                @foreach (GlobalMessage data in (List<GlobalMessage>) ViewData["ExpiredGlobalMessages"]) // apparently foreach is bad in views, think about changing to html.displayfor with viewmodels
                {
                    <tr>
                        <td>@data.Id</td>
                        <td>@data.Subject</td>
                        <td>@data.Body</td>
                        <td>
                            @foreach (Attachment attachment in data.Attachments)
                            {
                                <p>{"type": @attachment.Type, "rewardId": @attachment.RewardId, "quantity": @attachment.Quantity}</p>
                            }
                        </td>
                        <td>@data.VisibleFrom</td>
                        <td>@data.Expiration</td>
                        <td>@data.Icon</td>
                        <td>@data.Banner</td>
                        <td>@data.InternalNote</td>
                        <td>@data.ForAccountsBefore</td>
                        <td><button onclick="OpenEdit(@data.Id)">Edit</button></td>
                        <td><button onclick="OpenDelete(@data.Id)">Delete</button></td>
                    </tr>
                }
            </table>
        </div>
    </div>
</div>